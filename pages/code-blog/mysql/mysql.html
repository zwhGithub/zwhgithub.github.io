<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>MySQL知识 | 叫我华仔~</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://raw.githubusercontent.com/zwhGithub/images/master/img/img.jpg">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/zwhGithub/images/master/img/img.jpg">
    <link rel="mask-icon" href="https://raw.githubusercontent.com/zwhGithub/images/master/img/img.jpg" color="#3eaf7c">
    <meta name="description" content="Write the Code. Change the world">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="https://raw.githubusercontent.com/zwhGithub/images/master/img/img.jpg">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.3235b4b7.css" as="style"><link rel="preload" href="/assets/js/app.b3cde63a.js" as="script"><link rel="preload" href="/assets/js/2.7d04a557.js" as="script"><link rel="preload" href="/assets/js/19.32c3a22c.js" as="script"><link rel="prefetch" href="/assets/js/10.2eef0e18.js"><link rel="prefetch" href="/assets/js/11.937e092a.js"><link rel="prefetch" href="/assets/js/12.813ee8f2.js"><link rel="prefetch" href="/assets/js/13.e6976bca.js"><link rel="prefetch" href="/assets/js/14.6c0f035f.js"><link rel="prefetch" href="/assets/js/15.b76738cc.js"><link rel="prefetch" href="/assets/js/16.11a805f9.js"><link rel="prefetch" href="/assets/js/17.dadd86e4.js"><link rel="prefetch" href="/assets/js/18.95966a7e.js"><link rel="prefetch" href="/assets/js/20.f0faa6ff.js"><link rel="prefetch" href="/assets/js/21.814ad5c9.js"><link rel="prefetch" href="/assets/js/22.f245603e.js"><link rel="prefetch" href="/assets/js/23.726ec609.js"><link rel="prefetch" href="/assets/js/24.54970102.js"><link rel="prefetch" href="/assets/js/25.601213c1.js"><link rel="prefetch" href="/assets/js/26.4da03208.js"><link rel="prefetch" href="/assets/js/27.e44d173f.js"><link rel="prefetch" href="/assets/js/28.e5a53d10.js"><link rel="prefetch" href="/assets/js/29.993e01af.js"><link rel="prefetch" href="/assets/js/3.9b103ccd.js"><link rel="prefetch" href="/assets/js/30.164e54ae.js"><link rel="prefetch" href="/assets/js/31.65c9354c.js"><link rel="prefetch" href="/assets/js/32.367d618e.js"><link rel="prefetch" href="/assets/js/33.9f54ac0d.js"><link rel="prefetch" href="/assets/js/34.03b750f4.js"><link rel="prefetch" href="/assets/js/35.119ec487.js"><link rel="prefetch" href="/assets/js/36.b04d8de0.js"><link rel="prefetch" href="/assets/js/37.f165c860.js"><link rel="prefetch" href="/assets/js/38.c95da33e.js"><link rel="prefetch" href="/assets/js/39.1f5aadcf.js"><link rel="prefetch" href="/assets/js/4.42a2ea76.js"><link rel="prefetch" href="/assets/js/40.0227c185.js"><link rel="prefetch" href="/assets/js/41.29d95f57.js"><link rel="prefetch" href="/assets/js/42.5ba21573.js"><link rel="prefetch" href="/assets/js/43.3cffbe9f.js"><link rel="prefetch" href="/assets/js/44.ad19e274.js"><link rel="prefetch" href="/assets/js/45.500b2018.js"><link rel="prefetch" href="/assets/js/46.c5e11d16.js"><link rel="prefetch" href="/assets/js/47.4767ef35.js"><link rel="prefetch" href="/assets/js/48.41f962db.js"><link rel="prefetch" href="/assets/js/49.ece9855b.js"><link rel="prefetch" href="/assets/js/5.74759d65.js"><link rel="prefetch" href="/assets/js/50.a8337426.js"><link rel="prefetch" href="/assets/js/51.0ab7fc9d.js"><link rel="prefetch" href="/assets/js/52.43a492c7.js"><link rel="prefetch" href="/assets/js/53.e14e3323.js"><link rel="prefetch" href="/assets/js/54.fd1cadf1.js"><link rel="prefetch" href="/assets/js/55.854c5852.js"><link rel="prefetch" href="/assets/js/56.154b7bdb.js"><link rel="prefetch" href="/assets/js/6.d2d02449.js"><link rel="prefetch" href="/assets/js/7.9d79f4da.js"><link rel="prefetch" href="/assets/js/8.020aecc2.js"><link rel="prefetch" href="/assets/js/9.b0a031c1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3235b4b7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-6 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/img/icon.jpeg" alt="叫我华仔~" class="logo"> <span class="site-name">叫我华仔~</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="nav-space-between ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-18 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/pages/code-blog/" class="router-link-active">
          技术博客
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/pages/leetcode/">
          算法探索
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/pages/life/">
          生活点滴
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/pages/user/">
          关于我
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <ul class="extra-group"><li><a href="https://github.com/zwhGithub" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></li> <!----></ul></nav></div></div> <!----></header> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>MySQL知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/code-blog/mysql/mysql.html#一条sql查询语句是如何执行的" title="一条SQL查询语句是如何执行的" class="sidebar-link">一条SQL查询语句是如何执行的</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/code-blog/mysql/mysql.html#日志" title="日志" class="sidebar-link">日志</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#redo-log-重做日志" title="redo log（重做日志）" class="sidebar-link">redo log（重做日志）</a></li><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#binlog" title="binlog" class="sidebar-link">binlog</a></li><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#两种日志的不同" title="两种日志的不同" class="sidebar-link">两种日志的不同</a></li></ul></li><li><a href="/pages/code-blog/mysql/mysql.html#事务" title="事务" class="sidebar-link">事务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/code-blog/mysql/mysql.html#深入浅出索引" title="深入浅出索引" class="sidebar-link">深入浅出索引</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#覆盖索引" title="覆盖索引" class="sidebar-link">覆盖索引</a></li><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#联合索引" title="联合索引" class="sidebar-link">联合索引</a></li></ul></li><li><a href="/pages/code-blog/mysql/mysql.html#用户权限管理" title="用户权限管理" class="sidebar-link">用户权限管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#用户管理" title="用户管理" class="sidebar-link">用户管理</a></li><li class="sidebar-sub-header"><a href="/pages/code-blog/mysql/mysql.html#权限管理" title="权限管理" class="sidebar-link">权限管理</a></li></ul></li><li><a href="/pages/code-blog/mysql/mysql.html#mysql问答" title="MySQL问答" class="sidebar-link">MySQL问答</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page has-page-anchor"> <div class="theme-antdocs-content content__default"><h2 id="一条sql查询语句是如何执行的"><a href="#一条sql查询语句是如何执行的" class="header-anchor">#</a> 一条SQL查询语句是如何执行的</h2> <p><img src="https://tva1.sinaimg.cn/large/0060lm7Tly1g5ndxedv4ij31400u0tpc.jpg" alt=""></p> <h4 id="相关问题"><a href="#相关问题" class="header-anchor">#</a> 相关问题</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>table<span class="token punctuation">`</span></span> <span class="token keyword">WHERE</span> <span class="token keyword">key</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// table表不存在key字段，是在哪个阶段报错。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h2> <h3 id="redo-log-重做日志"><a href="#redo-log-重做日志" class="header-anchor">#</a> redo log（重做日志）</h3> <blockquote><p>MySQL 里经常说到的 WAL 技术，WAL 的全称是 WAL 的全称是 Write-Ahead Logging，它的关键点就是先写日志，再写磁盘。</p></blockquote> <h3 id="binlog"><a href="#binlog" class="header-anchor">#</a> binlog</h3> <blockquote><p>因为最开始 MySQL 里并没有 InnoDB 引擎。MySQL 自带的引擎是 MyISAM，但是 MyISAM 没有 crash-safe 的能力，binlog 日志只能用于归档。而 InnoDB 是另一个公司以插件形式引入 MySQL 的，既然只依靠 binlog 是没有 crash-safe 能力的，所以 InnoDB 使用另外一套日志系统——也就是 redo log 来实现 crash-safe 能力。</p></blockquote> <h3 id="两种日志的不同"><a href="#两种日志的不同" class="header-anchor">#</a> 两种日志的不同</h3> <ol><li>redo log 是 InnoDB 引擎特有的；binlog 是 MySQL 的 Server 层实现的，所有引擎都可以使用。</li> <li>redo log 是物理日志，记录的是“在某个数据页上做了什么修改”；binlog 是逻辑日志，记录的是这个语句的原始逻辑，比如“给 ID=2 这一行的 c 字段加 1 ”。</li> <li>redo log 是循环写的，空间固定会用完；binlog 是可以追加写入的。“追加写”是指 binlog 文件写到一定大小后会切换到下一个，并不会覆盖以前的日志。</li></ol> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <ul><li><ol><li>事务的特性：原子性、一致性、隔离性、持久性</li></ol></li> <li><ol start="2"><li>多事务同时执行的时候，可能会出现的问题：脏读、不可重复读、幻读</li></ol></li> <li><ol start="3"><li>事务隔离级别：读未提交、读提交、可重复读、串行化</li></ol></li> <li><ol start="4"><li>不同事务隔离级别的区别：</li></ol> <ul><li>读未提交：一个事务还未提交，它所做的变更就可以被别的事务看到</li> <li>读提交：一个事务提交之后，它所做的变更才可以被别的事务看到</li> <li>可重复读：一个事务执行过程中看到的数据是一致的。未提交的更改对其他事务是不可见的</li> <li>串行化：对应一个记录会加读写锁，出现冲突的时候，后访问的事务必须等前一个事务执行完成才能继续执行</li></ul></li> <li><ol start="5"><li>配置方法：启动参数transaction-isolation</li></ol></li> <li><ol start="6"><li>事务隔离的实现：每条记录在更新的时候都会同时记录一条回滚操作。同一条记录在系统中可以存在多个版本，这就是数据库的多版本并发控制（MVCC）。</li></ol></li> <li><ol start="7"><li>回滚日志什么时候删除？系统会判断当没有事务需要用到这些回滚日志的时候，回滚日志会被删除。</li></ol></li> <li><ol start="8"><li>什么时候不需要了？当系统里么有比这个回滚日志更早的read-view的时候。</li></ol></li> <li><ol start="9"><li>为什么尽量不要使用长事务。长事务意味着系统里面会存在很老的事务视图，在这个事务提交之前，回滚记录都要保留，这会导致大量占用存储空间。除此之外，长事务还占用锁资源，可能会拖垮库。</li></ol></li> <li><ol start="10"><li>事务启动方式：一、显式启动事务语句，begin或者start transaction, 提交commit，回滚rollback；二、set autocommit=0，该命令会把这个线程的自动提交关掉。这样只要执行一个select语句，事务就启动，并不会自动提交，直到主动执行commit或rollback或断开连接。</li></ol></li> <li><ol start="11"><li>建议使用方法一，如果考虑多一次交互问题，可以使用commit work and chain语法。在autocommit=1的情况下用begin显式启动事务，如果执行commit则提交事务。如果执行commit work and chain则提交事务并自动启动下一个事务。</li></ol></li></ul> <h4 id="理解事务"><a href="#理解事务" class="header-anchor">#</a> 理解事务</h4> <img src="https://tva1.sinaimg.cn/large/0060lm7Tly1g5q58fmsbij30u011b43h.jpg" style="width:400px;"> <p>我们来看看在不同的隔离级别下，事务 A 会有哪些不同的返回结果，也就是图里面 V1、V2、V3 的返回值分别是什么。</p> <ul><li>若隔离级别是“读未提交”， 则 V1 的值就是 2。这时候事务 B 虽然还没有提交，但是结果已经被 A 看到了。因此，V2、V3 也都是 2。</li> <li>若隔离级别是“读提交”，则 V1 是 1，V2 的值是 2。事务 B 的更新在提交后才能被 A 看到。所以， V3 的值也是 2。</li> <li>若隔离级别是“可重复读”，则 V1、V2 是 1，V3 是 2。之所以 V2 还是 1，遵循的就是这个要求：事务在执行期间看到的数据前后必须是一致的。</li> <li>若隔离级别是“串行化”，则在事务 B 执行“将 1 改成 2”的时候，会被锁住。直到事务 A 提交后，事务 B 才可以继续执行。所以从 A 的角度看， V1、V2 值是 1，V3 的值是 2。</li> <li>在实现上，数据库里面会创建一个视图，访问的时候以视图的逻辑结果为准。在“可重复读”隔离级别下，这个视图是在事务启动时创建的，整个事务存在期间都用这个视图。在“读提交”隔离级别下，这个视图是在每个 SQL 语句开始执行的时候创建的。这里需要注意的是，“读未提交”隔离级别下直接返回记录上的最新值，没有视图概念；而“串行化”隔离级别下直接用加锁的方式来避免并行访问。</li> <li>我们可以看到在不同的隔离级别下，数据库行为是有所不同的。Oracle 数据库的默认隔离级别其实就是“读提交”，因此对于一些从 Oracle 迁移到 MySQL 的应用，为保证数据库隔离级别的一致，你一定要记得将 MySQL 的隔离级别设置为“读提交”。</li></ul> <h2 id="深入浅出索引"><a href="#深入浅出索引" class="header-anchor">#</a> 深入浅出索引</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li>主键索引的叶子结点存储了整一行的内容（聚簇索引），使用主键可以快速获取到整行的数据。</li> <li>非主键索引的叶子结点存储的是主键的值，所以主键字段占用空间不宜过大。同时，其查找数据的过程称为“回表”，需要先查找自己得到主键值，再在主键索引上边查找数据内容。</li> <li>索引的实现由存储引擎来决定，InnoDB使用B+树（N叉树，比如1200叉树），把整颗树的高度维持在很小的范围内，同时在内存里缓存前面若干层的节点，可以极大地降低访问磁盘的次数，提高读的效率。</li> <li>B+树的插入可能会引起数据页的分裂，删除可能会引起数据页的合并，二者都是比较重的IO消耗，所以比较好的方式是顺序插入数据，这也是我们一般使用自增主键的原因之一。</li> <li>在Key-Value的场景下，只有一个索引且是唯一索引，则适合直接使用业务字段作为主键索引。</li> <li>索引不但写在内存中，还写在硬盘中。</li></ol></div> <h3 id="覆盖索引"><a href="#覆盖索引" class="header-anchor">#</a> 覆盖索引</h3> <blockquote><p>由于覆盖索引可以减少树的搜索次数，显著提升查询性能，所以使用覆盖索引是一个常用的性能优化手段。减少了IO磁盘读写读取正行数据。</p></blockquote> <ul><li><p>Q: 在一个市民信息表上，是否有必要将身份证号和名字建立联合索引？</p></li> <li><p>A: 有必要，如果有大量的查询是跟根据身份证Id来查询名字，这样是有必要的。它可以在这个高频请求上用到覆盖索引，不再需要回表查整行记录，减少语句的执行时间。</p></li></ul> <h3 id="联合索引"><a href="#联合索引" class="header-anchor">#</a> 联合索引</h3> <p><strong>在建立联合索引的时候，如何安排索引内的字段顺序</strong></p> <blockquote><p>第一原则是，如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的。</p></blockquote> <p><strong>最左原则字段</strong></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>(a, b, c)联合索引，其实是索引(a)、(a, b)、(a, b, c)</p></div> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code>mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> T <span class="token keyword">WHERE</span> k <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> T <span class="token keyword">WHERE</span> k <span class="token operator">BETWEEN</span> <span class="token number">1</span> <span class="token operator">AND</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment"># Q:为什么采用第二个查询方式优与第一个</span>
<span class="token comment"># A:第一个要树搜素5次,第二个搜索一次。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>alter table T engine=InnoDB 是用来释放 delete 操作引起的页的空洞, 也就是碎片空间</p></div> <h2 id="用户权限管理"><a href="#用户权限管理" class="header-anchor">#</a> 用户权限管理</h2> <h3 id="用户管理"><a href="#用户管理" class="header-anchor">#</a> 用户管理</h3> <h4 id="新增账户"><a href="#新增账户" class="header-anchor">#</a> 新增账户</h4> <ul><li>hostxxx：指定该用户在哪个主机上可以登陆，如果是本地用户可用localhost，如果想让该用户可以从任意远程主机登陆，可以使用通配符%。</li> <li>passwordxxx：该用户的登陆密码，密码可以为空，如果为空则该用户可以不需要密码登陆服务器。</li></ul> <p>示例：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'jack'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'rose'</span><span class="token variable">@'192.168.38.110_'</span> IDENDIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'rose'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'dev_code'</span><span class="token variable">@'%'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><font color="red">创建用户后，该用户只能连接到数据库服务器，但并没有操作该数据库服务器的权限。</font></p> <h4 id="删除用户"><a href="#删除用户" class="header-anchor">#</a> 删除用户</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token string">'usernamexxx'</span><span class="token variable">@'hostxxx'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="修改账户密码"><a href="#修改账户密码" class="header-anchor">#</a> 修改账户密码</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">use</span> mysql<span class="token punctuation">;</span> 

<span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> password<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span> 

flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h3> <h4 id="授予权限"><a href="#授予权限" class="header-anchor">#</a> 授予权限</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">GRANT</span> privilegesxxx <span class="token keyword">ON</span> databasenamexxx<span class="token punctuation">.</span>tablenamexxx <span class="token keyword">TO</span> <span class="token string">'usernamexxx'</span><span class="token variable">@'hostxxx'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>privilegesxxx：用户的操作权限，如SELECT，INSERT，UPDATE等，如果要授予所的权限则使用ALL。</li> <li>databasenamexxx：数据库名。</li> <li>tablenamexxx：表名，如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示，如</em>.*。</li></ul> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span><span class="token punctuation">,</span> <span class="token keyword">UPDATE</span><span class="token punctuation">,</span><span class="token keyword">DELETE</span> <span class="token keyword">ON</span> doctor<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">TO</span> <span class="token string">'jack'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'jack'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">ON</span> doctor<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'jack'</span><span class="token variable">@'%'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><font color="red">授权之后需要用户重连MySQL，才能获取相应的权限。</font></li> <li><font color="red">创建用户后，该用户只能连接到数据库服务器，但并没有操作该数据库服务器的权限。</font></li></ul> <h4 id="撤销用户权限"><a href="#撤销用户权限" class="header-anchor">#</a> 撤销用户权限</h4> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">REVOKE</span> privilege <span class="token keyword">ON</span> databasen<span class="token punctuation">.</span>tablen <span class="token keyword">FROM</span> <span class="token string">'user'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span>
<span class="token comment"># 示例</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">'jack'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="mysql问答"><a href="#mysql问答" class="header-anchor">#</a> MySQL问答</h2> <ul><li>Q：从 innodb 的索引结构分析，为什么索引的 key 长度不能太长？</li></ul> <blockquote><p>参考答案：key太长会导致一个页当中能够存放的key的数目变少，间接导致索引树的页数目变多，索引层次增加，从而影响整体查询变更的效率。</p></blockquote> <ul><li>Q：drop, delete与truncate的区别？</li></ul> <blockquote><p>参考搭建：drop直接删掉表，truncate删除表中数据，再插入时自增长id又从1开始，delete删除表中数据，可以加where字句。</p></blockquote> <ul><li>Q：DML、DLL、DCL分别代表什么？</li></ul> <blockquote><p>1、DML（data manipulation language）是数据操纵语言：它们是SELECT、UPDATE、INSERT、DELETE，就象它的名字一样，这4条命令是用来对数据库里的数据进行操作的语言。<br></p></blockquote> <p>2、DDL（data definition language）是数据定义语言：DDL比DML要多，主要的命令有CREATE、ALTER、DROP等，DDL主要是用在定义或改变表（TABLE）的结构，数据类型，表之间的链接和约束等初始化工作上，他们大多在建立表时使用。<br>
3、DCL（DataControlLanguage）是数据库控制语言：是用来设置或更改数据库用户或角色权限的语句，包括（grant, deny, revoke等）语句。</p> <ul><li>Q：MySQL 的数据如何恢复到任意时间点？</li></ul> <blockquote><p>参考答案：恢复到任意时间点以定时的做全量备份，以及备份增量的 binlog 日志为前提。恢复到任意时间点首先将全量备份恢复之后，再此基础上回放增加的 binlog 直至指定的时间点。</p></blockquote> <ul><li>Q：MySQL是如何写入的？</li></ul> <blockquote><p>参考答案： MySQL 里经常说到的 WAL 技术，WAL 的全称是 Write-Ahead Logging，它的关键点就是先写日志，再写磁盘。
具体来说，当有一条记录需要更新的时候，InnoDB 引擎就会先把记录写到 redo log里面，并更新内存，这个时候更新就算完成。
同时，InnoDB 引擎会在适当的时候，将这个操作记录更新到磁盘里面，而这个更新往往是在系统比较空闲的时候做。</p></blockquote> <blockquote><p>InnoDB 的 redo log 是固定大小的，比如可以配置为一组 4 个文件，每个文件的大小是 1GB，那么这块“粉板”总共就可以记录 4GB 的操作。从头开始写，写到末尾就又回到开头循环写，如下面这个图所示。</p></blockquote> <blockquote><p>如果要简单地对比这两个机制在提升更新性能上的收益的话，redo log 主要节省的是随机写磁盘的 IO 消耗（转成顺序写），而 change buffer 主要节省的则是随机读磁盘的 IO 消耗。</p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最近更新:</span> <span class="time">9/22/2022, 5:59:36 AM</span></div></footer> <!----> <div class="page-anchor"><div class="ant-space ant-space-vertical" style="width:100%;"><div class="ant-space-item"><div class="page-anchor-offset"><div><div class="ant-anchor-wrapper" style="max-height:100vh;"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a href="#一条sql查询语句是如何执行的" title="一条SQL查询语句是如何执行的" class="ant-anchor-link-title">一条SQL查询语句是如何执行的</a></div><div class="ant-anchor-link"><a href="#日志" title="日志" class="ant-anchor-link-title">日志</a><div class="ant-anchor-link"><a href="#redo-log-重做日志" title="redo log（重做日志）" class="ant-anchor-link-title">redo log（重做日志）</a></div><div class="ant-anchor-link"><a href="#binlog" title="binlog" class="ant-anchor-link-title">binlog</a></div><div class="ant-anchor-link"><a href="#两种日志的不同" title="两种日志的不同" class="ant-anchor-link-title">两种日志的不同</a></div></div><div class="ant-anchor-link"><a href="#事务" title="事务" class="ant-anchor-link-title">事务</a></div><div class="ant-anchor-link"><a href="#深入浅出索引" title="深入浅出索引" class="ant-anchor-link-title">深入浅出索引</a><div class="ant-anchor-link"><a href="#覆盖索引" title="覆盖索引" class="ant-anchor-link-title">覆盖索引</a></div><div class="ant-anchor-link"><a href="#联合索引" title="联合索引" class="ant-anchor-link-title">联合索引</a></div></div><div class="ant-anchor-link"><a href="#用户权限管理" title="用户权限管理" class="ant-anchor-link-title">用户权限管理</a><div class="ant-anchor-link"><a href="#用户管理" title="用户管理" class="ant-anchor-link-title">用户管理</a></div><div class="ant-anchor-link"><a href="#权限管理" title="权限管理" class="ant-anchor-link-title">权限管理</a></div></div><div class="ant-anchor-link"><a href="#mysql问答" title="MySQL问答" class="ant-anchor-link-title">MySQL问答</a></div></div></div></div></div></div></div></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b3cde63a.js" defer></script><script src="/assets/js/2.7d04a557.js" defer></script><script src="/assets/js/19.32c3a22c.js" defer></script>
  </body>
</html>