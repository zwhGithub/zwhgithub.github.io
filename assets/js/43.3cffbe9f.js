(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{729:function(t,s,a){"use strict";a.r(s);var n=a(81),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"redis之-bitmaps位图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis之-bitmaps位图"}},[t._v("#")]),t._v(" Redis之 Bitmaps位图")]),t._v(" "),s("h2",{attrs:{id:"什么是-bitmaps"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-bitmaps"}},[t._v("#")]),t._v(" 什么是 Bitmaps")]),t._v(" "),s("p",[t._v("Bitmaps 并不是实际的数据类型，而是定义在String类型上的一个面向字节操作的集合。因为字符串是二进制安全的块，他们的最大长度是512M，最适合设置成2^32个不同字节。")]),t._v(" "),s("p",[t._v("Bitmaps 的最大优势之一在存储信息时极其节约空间。例如，在一个以增量用户ID来标识不同用户的系统中，记录用户的四十亿的一个单独bit信息（例如，要知道用户是否想要接收最新的来信）仅仅使用512M内存。")]),t._v(" "),s("h2",{attrs:{id:"常用命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用命令"}},[t._v("#")]),t._v(" 常用命令")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 给位图指定索引设置值，返回该索引位置的原始值")]),t._v("\nsetbit key offset value \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取位图指定索引的值")]),t._v("\ngetbit key offset \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取位图指定范围（start到end，单位为字节，如果不指定就是获取全部）位值为1的个数。")]),t._v("\nbitcount key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("start end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 做多个bitmap的and（交集）、or（并集）、not（非）、xor（异或）操作并将结果保存到destkey中。")]),t._v("\n bitop and"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("or"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("not"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("xor destkey key "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 计算位图指定范围（start到end，单位为字节，如果不指定就是获取全部）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 第一个偏移量对应的值等于targetBit的位置。")]),t._v("\n bitpos key targetBit "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("start"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" \n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("h2",{attrs:{id:"实战应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战应用"}},[t._v("#")]),t._v(" 实战应用")]),t._v(" "),s("h3",{attrs:{id:"独立用户访问统计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#独立用户访问统计"}},[t._v("#")]),t._v(" 独立用户访问统计")]),t._v(" "),s("ol",[s("li",[t._v("使用 set 和 Bitmap （前提是用户的ID必须是整型）")]),t._v(" "),s("li",[t._v("1亿用户，五千万独立")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("数据类型")])]),t._v(" "),s("th",[s("strong",[t._v("每个userId占用空间")])]),t._v(" "),s("th",[t._v("需要存储的用户量")]),t._v(" "),s("th",[s("strong",[t._v("内存使用总量")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("set")]),t._v(" "),s("td",[t._v("32位(假设userId用的是integer)")]),t._v(" "),s("td",[t._v("50,000,000")]),t._v(" "),s("td",[t._v("32位*50,000,000=200MB")])]),t._v(" "),s("tr",[s("td",[t._v("Bitmap")]),t._v(" "),s("td",[t._v("1位")]),t._v(" "),s("td",[t._v("100,000,000")]),t._v(" "),s("td",[t._v("1位*100,000,000=12.5MB")])])])]),t._v(" "),s("ol",[s("li",[t._v("若只有10万独立用户")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[s("strong",[t._v("数据类型")])]),t._v(" "),s("th",[s("strong",[t._v("每个userId占用空间")])]),t._v(" "),s("th",[t._v("需要存储的用户量")]),t._v(" "),s("th",[s("strong",[t._v("内存使用总量")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("set")]),t._v(" "),s("td",[t._v("32位(假设userId用的是integer)")]),t._v(" "),s("td",[t._v("100,000")]),t._v(" "),s("td",[t._v("32位*100,000=4MB")])]),t._v(" "),s("tr",[s("td",[t._v("Bitmap")]),t._v(" "),s("td",[t._v("1位")]),t._v(" "),s("td",[t._v("100,000,000")]),t._v(" "),s("td",[t._v("1位*100,000,000=12.5MB")])])])]),t._v(" "),s("h2",{attrs:{id:"使用经验"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用经验"}},[t._v("#")]),t._v(" 使用经验")]),t._v(" "),s("ol",[s("li",[t._v("string类型最大长度为512M。")]),t._v(" "),s("li",[t._v("注意setbit时的偏移量，当偏移量很大时，可能会有较大耗时。")]),t._v(" "),s("li",[t._v("位图不是绝对的好，有时可能更浪费空间。")])])])}),[],!1,null,null,null);s.default=e.exports}}]);