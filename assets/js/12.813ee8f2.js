(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{698:function(a,s,t){"use strict";t.r(s);var e=t(81),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"mysql空间碎片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql空间碎片"}},[a._v("#")]),a._v(" MySQL空间碎片")]),a._v(" "),s("h2",{attrs:{id:"碎片产生的原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#碎片产生的原因"}},[a._v("#")]),a._v(" 碎片产生的原因")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("对于mysql表数据，当你delete掉很多数据时，这些数据占用的磁盘空间可能并不会立刻被回收；比如一张表有10G的数据，delete掉1G数据后，再查看表ibd文件会发现文件大小可能还是10G；如果这个表有insert操作的话，那么mysql就会优先考虑能不能将新数据存储到空白空间上，容易出现这样的情况：某个空白空间的大小是2MB，新插入一条数据大小是1.5MB并存储到该空白空间上，这时就会产生更小的空白空间，而这种更小的空白空间更难被利用，如果像这种碎片非常多，就会比较浪费资源而且降低表磁盘I/O性能。")])]),a._v(" "),s("li",[s("p",[a._v("对于频繁地update操作，也很容易产生碎片问题。比如对于可变长字段，如varchar、text、blob等字段，如果update操作将数据大小改小，那么也会产生碎片问题。")])]),a._v(" "),s("li",[s("p",[a._v("mysql目前比较常用的引擎是innodb和myisam，这两种引擎下都有可能产生碎片，碎片的产生和消除都是随机的，而碎片越多会给查询扫描工作带来越大的影响。")])])]),a._v(" "),s("h2",{attrs:{id:"空间碎片回收"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#空间碎片回收"}},[a._v("#")]),a._v(" 空间碎片回收")]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("SHOW")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("STATUS")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("LIKE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'table'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("可以查看到数据碎片信息，返回数据中，Data_free大于0时即说明存在数据碎片。")]),a._v(" "),s("h3",{attrs:{id:"innodb表优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#innodb表优化"}},[a._v("#")]),a._v(" innodb表优化")]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ALTER")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" tb_name "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENGINE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("INNODB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h3",{attrs:{id:"myisam表优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#myisam表优化"}},[a._v("#")]),a._v(" myisam表优化")]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("OPTIMIZE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("TABLE")]),a._v(" tb_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("值得注意的，以上方式都是锁表")])]),a._v(" "),s("h2",{attrs:{id:"optimize操作介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#optimize操作介绍"}},[a._v("#")]),a._v(" optimize操作介绍")]),a._v(" "),s("p",[a._v("mysql5.6的官方文档在13.7.2.4小节对optimize操作有详细的介绍。optimize table命令的作用是重新组织表数据和关联索引数据的物理存储，以减小存储空间并提高访问表时的I/O效率；命令主要作用于innodb、myisam和archive引擎表，而命令对表所做的实际更改取决于该表使用的存储引擎。\n·innodb引擎下的optimize操作\n对于innodb表，optimize table操作实际映射为alter table ... force操作")]),a._v(" "),s("h2",{attrs:{id:"优化建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优化建议"}},[a._v("#")]),a._v(" 优化建议")]),a._v(" "),s("ul",[s("li",[a._v("清除碎片操作会暂时锁表，数据量越大，耗费的时间越长，可以做个脚本，定期在访问低谷时间执行，例如每周三凌晨，检查DATA_FREE字段，大于自己认为的警戒值的话，就清理一次。")]),a._v(" "),s("li",[s("a",{attrs:{href:"https://help.aliyun.com/document_detail/128340.html?spm=a2c4g.11186623.6.646.435a51f9KinzA4",target:"_blank",rel:"noopener noreferrer"}},[a._v("阿里云提供的有最佳实践。"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=r.exports}}]);